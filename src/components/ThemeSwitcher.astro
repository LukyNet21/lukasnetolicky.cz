---
import Sun from "../assets/icons/sun.svg";
import Moon from "../assets/icons/moon.svg";
---

<button id="theme-switcher" aria-label="Toggle theme">
  <Sun id="sun-icon" class="hidden" width="24" height="24" />
  <Moon id="moon-icon" width="24" height="24" />
</button>

<script>
  document.addEventListener("astro:page-load", () => {
    const themeButton = document.getElementById("theme-switcher");
    const sunIcon = document.getElementById("sun-icon") as HTMLElement;
    const moonIcon = document.getElementById("moon-icon") as HTMLElement;

    function getInitialTheme() {
      const savedTheme = localStorage.getItem("theme");
      if (savedTheme) {
        return savedTheme;
      }
      if (window.matchMedia("(prefers-color-scheme: light)").matches) {
        return "light";
      }
      return "dark";
    }

    function applyTheme(theme: string) {
      document.body.classList.toggle("light", theme === "light");
      const lightMode = theme === "light";
      sunIcon.classList.toggle("hidden", lightMode);
      moonIcon.classList.toggle("hidden", !lightMode);
    }

    function toggleTheme() {
      const currentTheme = document.body.classList.contains("light")
        ? "light"
        : "dark";
      const newTheme = currentTheme === "light" ? "dark" : "light";
      localStorage.setItem("theme", newTheme);
      applyTheme(newTheme);
    }

    const initialTheme = getInitialTheme();
    applyTheme(initialTheme);

    if (!localStorage.getItem("theme")) {
      localStorage.setItem("theme", initialTheme);
    }
    themeButton?.addEventListener("click", toggleTheme);
  });
</script>

<style>
  #theme-switcher {
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    transition:
      color 0.2s ease,
      transform 0.2s ease;
  }

  #theme-switcher:hover {
    color: var(--text);
    transform: scale(1.1);
  }

  .sun-icon,
  .moon-icon {
    transition: opacity 0.2s ease;
  }

  .hidden {
    display: none;
  }
</style>
